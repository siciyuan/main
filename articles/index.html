<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>技术文章</title>
    
    <!-- CDN 依赖 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- 本地资源 -->
    <link rel="stylesheet" href="../style.css">
    <link rel="icon" type="image/x-icon" href="../logo.ico">
</head>
<body class="theme-transition min-h-screen">
    <div id="app">
        <!-- 粒子背景容器 -->
        <div id="particles-bg" class="particles-bg"></div>
        
        <!-- 主题选择器 -->
        <div class="theme-selector" v-if="config.themes">
            <div class="glass-card rounded-full p-2 flex space-x-2">
                <button 
                    v-for="theme in config.themes" 
                    :key="theme.id"
                    @click="themeManager.changeTheme(theme.id)"
                    class="w-6 h-6 rounded-full border-2 border-white/30 focus:outline-none transition-transform hover:scale-110"
                    :style="{backgroundColor: theme.color}"
                    :title="theme.name"
                ></button>
            </div>
        </div>
        
        <!-- 主内容区域 -->
        <main class="container mx-auto px-4 py-8 max-w-6xl">
            <!-- 文章标题 -->
            <section class="glass-card rounded-2xl p-8 mb-8 scroll-reveal" v-if="config.articles">
                <h1 class="text-4xl md:text-5xl font-bold text-center mb-4">{{ config.articles.title }}</h1>
                <p class="text-lg text-center opacity-90">{{ config.articles.description }}</p>
            </section>
            
            <!-- 文章分类 -->
            <section class="mb-8" v-if="config.categories">
                <div class="flex flex-wrap gap-3 justify-center">
                    <button 
                        v-for="category in config.categories" 
                        :key="category.id"
                        @click="filterByCategory(category.id)"
                        class="px-4 py-2 rounded-full glass-card hover:bg-white/20 transition-all duration-300"
                    >
                        {{ category.name }}
                    </button>
                </div>
            </section>
            
            <!-- 文章列表 -->
            <section class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16" v-if="filteredPosts.length > 0">
                <div 
                    v-for="post in filteredPosts" 
                    :key="post.id"
                    class="glass-card rounded-2xl p-6 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 scroll-reveal"
                >
                    <!-- 文章缩略图 -->
                    <div class="mb-4 overflow-hidden rounded-xl">
                        <img 
                            :src="post.thumbnail" 
                            :alt="post.title"
                            class="w-full h-48 object-cover transition-transform duration-500 hover:scale-105"
                            loading="lazy"
                        >
                    </div>
                    
                    <!-- 文章信息 -->
                    <h2 class="text-xl font-bold mb-2">{{ post.title }}</h2>
                    <p class="text-sm opacity-90 mb-4">{{ post.description }}</p>
                    
                    <!-- 文章元信息 -->
                    <div class="flex flex-wrap gap-3 mb-4">
                        <span class="px-2 py-1 bg-white/10 rounded text-xs">{{ getCategoryName(post.categoryId) }}</span>
                        <span class="px-2 py-1 bg-white/10 rounded text-xs">{{ post.date }}</span>
                        <span class="px-2 py-1 bg-white/10 rounded text-xs">
                            <i class="fas fa-eye mr-1"></i>{{ post.readCount }}
                        </span>
                    </div>
                    
                    <!-- 文章标签 -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span 
                            v-for="(tag, index) in post.tags" 
                            :key="index"
                            class="px-2 py-1 bg-white/10 rounded text-xs"
                        >
                            {{ tag }}
                        </span>
                    </div>
                    
                    <!-- 阅读按钮 -->
                    <div class="text-center">
                        <a 
                            :href="post.url" 
                            target="_blank"
                            class="inline-block px-4 py-2 rounded-lg glass-card hover:bg-white/20 transition-all duration-300"
                        >
                            阅读全文
                        </a>
                    </div>
                </div>
            </section>
            
            <!-- 无文章提示 -->
            <section class="glass-card rounded-2xl p-8 text-center" v-else-if="config.posts && config.posts.length === 0">
                <p class="text-lg">暂无文章</p>
            </section>
        </main>
        
        <!-- 页脚 -->
        <footer class="pt-16 pb-24 md:pb-32 text-center opacity-80" v-if="config.footer">
            <div class="container mx-auto px-4 max-w-6xl">
                <p>{{ config.footer.copyright }}</p>
                <p class="mt-2" v-html="config.footer.extraInfo"></p>
                
                <!-- 页脚链接 -->
                <div class="flex flex-wrap justify-center gap-6 mt-6" v-if="config.footer.links">
                    <a 
                        v-for="link in config.footer.links" 
                        :key="link.id"
                        :href="link.url"
                        class="hover:text-white/100 transition-colors"
                    >
                        {{ link.name }}
                    </a>
                </div>
            </div>
        </footer>
    </div>
    <script src="//cdn.busuanzi.cc/busuanzi/3.6.9/busuanzi.min.js" defer></script>
今日总访问量 <span id="busuanzi_today_pv">加载中...</span> 次
今日总访客数 <span id="busuanzi_today_uv">加载中...</span> 人
本站总访问量 <span id="busuanzi_site_pv">加载中...</span> 次
本站总访客数 <span id="busuanzi_site_uv">加载中...</span> 人
本页总阅读量 <span id="busuanzi_page_pv">加载中...</span> 次
本页总访客数 <span id="busuanzi_page_uv">加载中...</span> 人
    <!-- 本地模块 -->
    <script src="../theme-manager.js"></script>
    <script defer>
        // 创建技术文章Vue应用
        const { createApp, onMounted, reactive, ref, computed } = Vue;
        
        createApp({
            setup() {
                const config = reactive({
                    articles: {
                        title: "技术文章",
                        description: "分享我的技术心得和学习笔记"
                    },
                    categories: [],
                    posts: [],
                    themes: [
                        { "id": "light", "name": "亮白", "color": "#f8fafc", "bg": "#f1f5f9", "text": "#475569" },
                        { "id": "graphite", "name": "石墨黑", "color": "#64748b", "bg": "#1e293b", "text": "#e2e8f0" },
                        { "id": "lime", "name": "青柠", "color": "#a3e635", "bg": "#fefce8", "text": "#4d7c0f" },
                        { "id": "lemon", "name": "柠黄", "color": "#fde68a", "bg": "#fffbeb", "text": "#a16207" },
                        { "id": "apple", "name": "苹果绿", "color": "#4ade80", "bg": "#f0fdf4", "text": "#166534" },
                        { "id": "water", "name": "水蓝", "color": "#60a5fa", "bg": "#eff6ff", "text": "#1e40af" },
                        { "id": "cherry", "name": "樱红", "color": "#fda4af", "bg": "#fef2f2", "text": "#9f1239" },
                        { "id": "lavender", "name": "薰衣草紫", "color": "#c4b5fd", "bg": "#faf5ff", "text": "#6b21a8" }
                    ],
                    settings: {
                        defaultTheme: "water",
                        enableParticles: true
                    },
                    footer: {
                        copyright: "© 2026 鳞游. 保留所有权利.",
                        extraInfo: "由Vue与Tailwind CSS 构建 | 本页面后端由 <a href='https://www.xiaojiyun.com/aff/WPNPVVXD' target='_blank'>小鸡云</a> 提供 | 我日常玩的免费mc服务器就在这开的 <a href='https://www.xiaojiyun.com/aff/WPNPVVXD' target='_blank'>点击查看</a>",
                        links: [
                            { "id": 1, "name": "隐私政策", "url": "#" },
                            { "id": 2, "name": "使用条款", "url": "#" },
                            { "id": 3, "name": "站点地图", "url": "#" },
                            { "id": 4, "name": "友情链接", "url": "#" }
                        ]
                    }
                });
                
                const selectedCategory = ref(null);
                const themeManager = new ThemeManager();
                const loading = ref(true);
                
                // 加载配置文件
                const loadConfig = async () => {
                    try {
                        // 并行加载两个配置文件，提高加载速度
                        const [mainResponse, articlesResponse] = await Promise.all([
                            fetch('../config.json'),
                            fetch('config.json')
                        ]);
                        
                        if (!mainResponse.ok) {
                            throw new Error('Failed to load main config.json');
                        }
                        
                        if (!articlesResponse.ok) {
                            throw new Error('Failed to load articles config.json');
                        }
                        
                        // 并行解析JSON数据
                        const [mainData, articlesData] = await Promise.all([
                            mainResponse.json(),
                            articlesResponse.json()
                        ]);
                        
                        // 合并配置
                        Object.assign(config, mainData, articlesData);
                        
                        // 初始化主题
                        if (mainData.settings?.defaultTheme) {
                            themeManager.init(mainData.themes, mainData.settings.defaultTheme);
                        }
                        
                        // 初始化粒子效果
                        if (mainData.settings?.enableParticles) {
                            setTimeout(() => themeManager.initParticles(), 100);
                        }
                    } catch (error) {
                        console.error('Error loading config:', error);
                        // 加载失败时不使用默认数据，确保从config.json加载
                        
                        // 使用默认主题
                        themeManager.init(config.themes, config.settings.defaultTheme);
                        
                        // 初始化粒子效果
                        setTimeout(() => themeManager.initParticles(), 100);
                    } finally {
                        loading.value = false;
                    }
                };
                
                // 过滤文章
                const filteredPosts = computed(() => {
                    if (!selectedCategory.value) {
                        return config.posts;
                    }
                    return config.posts.filter(post => post.categoryId === selectedCategory.value);
                });
                
                // 按分类过滤
                const filterByCategory = (categoryId) => {
                    if (selectedCategory.value === categoryId) {
                        selectedCategory.value = null;
                    } else {
                        selectedCategory.value = categoryId;
                    }
                };
                
                // 获取分类名称
                const getCategoryName = (categoryId) => {
                    const category = config.categories.find(cat => cat.id === categoryId);
                    return category ? category.name : '未分类';
                };
                
                // 滚动动画逻辑
                const handleScroll = () => {
                    const elements = document.querySelectorAll('.scroll-reveal');
                    elements.forEach(element => {
                        const elementTop = element.getBoundingClientRect().top;
                        const elementVisible = 150;
                        if (elementTop < window.innerHeight - elementVisible) {
                            element.classList.add('active');
                        }
                    });
                };
                
                // 字体懒加载函数
                const loadFont = () => {
                    console.log('开始加载字体...');
                    // 创建字体加载器
                    const fontFace = new FontFace('CustomFont', 'url(../font.ttf)');
                    
                    // 加载字体
                    fontFace.load().then((font) => {
                        console.log('字体加载成功:', font);
                        // 添加字体到字体族
                        document.fonts.add(font);
                        
                        // 更新所有元素的字体样式
                        document.documentElement.style.fontFamily = 'CustomFont, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif';
                        document.body.style.fontFamily = 'CustomFont, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif';
                        
                        // 添加一个样式规则，确保优先级
                        const style = document.createElement('style');
                        style.textContent = '* { font-family: "CustomFont", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif !important; }';
                        document.head.appendChild(style);
                        
                        console.log('字体应用成功');
                    }).catch((error) => {
                        console.error('字体加载失败:', error);
                    });
                };
                
                // 节流函数
                const throttle = (func, limit) => {
                    let inThrottle;
                    return function() {
                        const args = arguments;
                        const context = this;
                        if (!inThrottle) {
                            func.apply(context, args);
                            inThrottle = true;
                            setTimeout(() => inThrottle = false, limit);
                        }
                    };
                };
                
                onMounted(() => {
                    // 加载配置
                    loadConfig();
                    
                    // 加载字体
                    loadFont();
                    
                    // 初始加载时触发一次滚动动画
                    handleScroll();
                    
                    // 监听滚动事件（使用节流函数）
                    const throttledHandleScroll = throttle(handleScroll, 100);
                    window.addEventListener('scroll', throttledHandleScroll);
                });
                
                return {
                    config,
                    themeManager,
                    selectedCategory,
                    filteredPosts,
                    filterByCategory,
                    getCategoryName,
                    loading
                };
            }
        }).mount('#app');
    </script>
</body>
</html>